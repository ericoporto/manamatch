Stage stage_p1;
EndlessLevel levels;

void _AdjustLevel()
{    
  stage_p1.SetTypeProbabilities(levels.GetLevelProbabilities());
  if(levels.Level == 5) Sound_MusicPlay(aMus_arcade_lvl02);
}

function room_AfterFadeIn()
{
  Sound_MusicPlay(aMus_arcade_lvl01);
  
  stage_p1.Init(Point.Create(0, 0), 
             Point.Create(Screen.Width, Screen.Height), 
             Point.Create(8, 8), 
             22, 
             levels.GetLevelProbabilities());
  stage_p1.ReplacePieces = true;
  _AdjustLevel();

}

function room_Load()
{
  levels.PushLevel(500, "1.0,1.0,1.0,1.0");
  levels.PushLevel(500, "0.0,1.0,2.0,3.0,4.0");
  levels.PushLevel(500, "1.0,2.0,2.0,1.0");
  levels.PushLevel(500, "1.0,1.0,1.0,1.0,1.0,0.25");
  levels.PushLevel(500, "1.0,1.0,1.0,1.0,2.0");
  levels.PushLevel(500, "1.0,1.0,1.0,1.0,1.0,1.0");
}

function room_RepExec()
{
  obj_stage_p1.Graphic = stage_p1.Render();
  stage_p1.Update();
  
  if(levels.IsScoreBeyondThreshold(stage_p1.Score.Value))
  {
    levels.LevelUp();
    _AdjustLevel();
  }
}

function room_Leave()
{
  obj_stage_p1.Graphic = 0;
  stage_p1.Delete();
}
